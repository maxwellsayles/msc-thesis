\documentclass{ucalgthes1}   
\usepackage[letterpaper,top=1in, bottom=1.22in, left=1.40in, right=0.850in]{geometry}
\usepackage{fancyhdr}
\fancyhead{}
\fancyfoot{}
\renewcommand{\headrulewidth}{0pt}
\fancyhead[RO,LE]{\thepage}  
\usepackage{hyperref}

\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{comment}
\usepackage{float}

\theoremstyle{plain}
\newtheorem{thm}{Theorem}[section]
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}

\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}

\newcommand{\CC}{\mathbb{C}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\KK}{\mathbb{K}}
\newcommand{\MM}{\mathcal{M}}
\newcommand{\OO}{\mathcal{O}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\NP}{\textrm{NP}}
\newcommand{\RRgtz}{\mathbb{R}_{>0}}
\newcommand{\ZZgtz}{\mathbb{Z}_{>0}}
\newcommand{\ZZgez}{\mathbb{Z}_{\ge 0}}
\newcommand{\QQgtz}{\mathbb{Q}_{>0}}
\newcommand{\QQgez}{\mathbb{Q}_{\ge 0}}
\newcommand{\matrixto}[2]{\left( \begin{array}{rr} #1 & #2 \end{array} \right)}
\newcommand{\matrixot}[2]{\left( \begin{array}{r} #1 \\ #2 \end{array} \right)}
\newcommand{\matrixtt}[4]{\left( \begin{array}{rr} #1 & #2 \\ #3 & #4 \end{array} \right)}
\newcommand{\ntoinfty}{\lim_{n \rightarrow \infty}}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}

%\setlength{\parindent}{0pt}
%\setlength{\parskip}{2ex} 

\begin{document}

\setcounter{chapter}{1}
\chapter{Ideal Arithmetic}
\label{chap:idealArithmetic}

The focus of this thesis is fast arithmetic and fast exponentiation in the ideal class group of imaginary quadratic number fields.  The ideal class group is the group of equivalence classes of ideals in the maximal order of a quadratic number field.   We begin with the relevant theory of quadratic number fields, then discuss quadratic orders and ideals of quadratic orders.  Finally, we discuss arithmetic in the ideal class group.  The theory presented here is available in detail in reference texts on algebraic number theory such as \cite{IR90}, \cite{Hua82}, or \cite{Coh80}. 



%%%%%%%%%%%%%%%%%%%%%
% QUADRATIC NUMBERS %
%%%%%%%%%%%%%%%%%%%%%
\section{Quadratic Numbers}

The ideal class group of imaginary quadratic numbers begins with quadratic numbers, a type of algebraic number, so we begin there.   

\begin{defn}
An \emph{algebraic number} is a root $\alpha$ of a polynomial $f(x) \in \QQ[x]$ with rational coefficients.
\end{defn}

\noindent
Given an algebraic number $\alpha$, we create an algebraic number field as the extension field of $\QQ$ obtained by adjoining $\alpha$, denoted $\QQ(\alpha)$. Let $\KK$ be our algebraic number field; we can write $\KK$ as
\[
	\KK = \QQ(\alpha) = \left\{ \frac{f(\alpha)}{g(\alpha)} : f(x), g(x) \in \QQ[x]; g(\alpha) \ne 0 \right\}.
\]

\noindent
An example of algebraic numbers of degree 1 are the rational numbers $\QQ$, since $a/b \in \QQ$ is a root of $bx - a$, a degree 1 polynomial.  Quadratic numbers are algebraic numbers of degree 2.  For example, given a polynomial $f(x) = ax^2 + bx + c$ with integer coefficients, the root $\alpha$ is given by the quadratic formula
\[
	\alpha = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a} ~.
\]
Let $\Delta = b^2 -4ac$ such that $\Delta \in \ZZ$ is the discriminant of $f(x)$.  Then our quadratic number field $\KK$ is 
\[
	\KK = \QQ(\alpha) = \QQ(\sqrt{\Delta}) = \{u + v\sqrt{\Delta} : u,v \in \QQ\}.
\]
When $\Delta$ is positive, $\KK$ is a \emph{real} quadratic number field, and when $\Delta$ is negative, $\KK$ is an \emph{imaginary} quadratic number field.  Here we deal only with the imaginary case.  Notice that $\Delta \equiv 0,1 \pmod 4$.  Also, if $\Delta = f^2 \Delta_0$ for some $f \in \ZZ$ where $\Delta_0$ is squarefree, then $\KK = \QQ(\Delta_0)$.


%%%%%%%%%%%%%%%%%%%%%%
% QUADRATIC INTEGERS %
%%%%%%%%%%%%%%%%%%%%%%
\bigbreak
\section{Quadratic Integers}

When $g(x)$ is a monic polynomial with integer coefficients, we say that a root $\alpha$ is an \emph{algebraic integer}.

\begin{defn}
\label{defn:quadraticInteger}
A \emph{quadratic integer} $\beta$ is an algebraic integer of $\QQ(\sqrt{\Delta_0})$ where $\beta$ can be written as $\beta = i + j \omega_0$ for some $i,j \in \ZZ$ and
\begin{equation*}
	\omega_0 = \begin{cases}
		\sqrt{\Delta_0} & \textrm{ when } \Delta_0 \not \equiv 1 \pmod 4 \\
		\frac{1+\sqrt{\Delta_0}}{2} & \textrm{ when } \Delta_0 \equiv 1 \pmod 4.
	\end{cases}
\end{equation*}
\end{defn}

Recall that an algebraic number $\beta$ of $\QQ(\sqrt\Delta_0)$ is $\beta = u+v\sqrt\Delta_0$ for some $u,v \in \QQ$.  For $\beta$ to be an  algebraic integer it must be a root of a monic quadratic polynomial $f(x) = x^2+bx+c$ for some $b,c \in \ZZ$ (note the coefficient of $x^2$ is 1).  The roots are given by
\begin{equation*}
	\beta = u + v\sqrt{\Delta_0} = \frac{-b \pm \sqrt{b^2-4c}}{2}.
\end{equation*}
Equating rational and irrational parts we have
\begin{equation*}
	u = -\frac{b}{2}
\end{equation*}
and
\begin{equation*}
	v \sqrt{\Delta_0} = \frac{\sqrt{b^2 -4c}}{2}
\end{equation*}
and so
\begin{equation}
\label{eq:v2}
	v^2 \Delta_0 = \frac{b^2}{4} - c.
\end{equation}


There are two cases: $b$ is even or odd. Suppose $b$ is even.  Then $b=2b'$ for some $b' \in \ZZ$.  This implies that $u = -b'$ and $u \in \ZZ$.  By \eqref{eq:v2} we have
\begin{eqnarray*}
	v^2 \Delta_0 & = & \frac{(2b')^2}{4} - c \\
	& = & b'^2 - c
\end{eqnarray*}
and $v \in \ZZ$, since $b', c, \Delta_0 \in \ZZ$.  Therefore, when $b$ is even, it follows that $\beta = u + v \sqrt{\Delta_0}$ is a quadratic integer.

\bigbreak
Now suppose $b$ is odd; then $b=2b' + 1$ for some $b' \in \ZZ$.  Again, equating rational and irrational parts we have
\[
	u = - \frac{b}{2} = -b' - \frac{1}{2}
\]
and
\begin{eqnarray*}
	v^2 \Delta_0 & = & \frac{(2b'+1)^2}{4} - c \\
	& = & b'^2 + b' + \frac{1}{4} -c.
\end{eqnarray*}
Let $v = \frac{j}{2}$ for some $j \in \ZZ$.  Then
\begin{equation*}
	\frac{j^2}{4} \Delta_0 = b'^2 + b' + \frac{1}{4} -c,
\end{equation*}
and as such
\begin{equation*}
	j^2 \Delta_0 \equiv 1 \pmod 4.
\end{equation*}

\noindent
This is only possible when $j \equiv 1,3 \pmod 4$ and $\Delta_0 \equiv 1 \pmod 4$.  Let $v = j/2$ and $u = i + j/2$ for some $i, j \in \ZZ$.  Then
\begin{eqnarray*}
	\beta & = & u + v \sqrt{\Delta_0} \\
	& = & i + \frac{j}{2} + \frac{j \sqrt{\Delta_0}}{2} \\
	& = & i + j \left( \frac{1 + \sqrt{\Delta_0}}{2} \right).
\end{eqnarray*}


%%%%%%%%%%%%%%%%%
% MAXIMAL ORDER %
%%%%%%%%%%%%%%%%%
\bigbreak
\section{Maximal Order of Algebraic Integers}
The ring of all algebraic integers of a number field $\KK$ is the \emph{maximal order} of $\KK$.  To describe the \emph{maximal order} of $\KK$, we begin by defining a \emph{$\ZZ$-module}.  

\begin{defn}
Given a subset of a number field $X = \{ \xi_1, \xi_2, \xi_3, ..., \xi_n \} \subseteq \KK$, the \emph{$\ZZ$-module} $\MM$ is generated as the set of all linear combinations of the elements of $X$ with integer coefficients:
\[
	\MM = \left \{ \sum_{i}^n x_i \xi_i : x_i \in \ZZ, \xi_i \in X \right \}.
\]
We denote this as
\[
	\MM = [ \xi_1, \xi_2, ..., \xi_n ].
\]
\end{defn}

\begin{defn}
An \emph{order} $\OO$ of $\KK$ is a $\ZZ$-module of $\KK$ such that $\OO$ is a subring of $\KK$ containing 1.
\end{defn}

\noindent
Orders of quadratic fields can be written as  $\OO_\Delta = [1, f\omega_0]$ where $\Delta = f^2\Delta_0$ for some $f \in \ZZ$.  We call $f$ the \emph{conductor} of $\OO_\Delta$.  Note that by Definition \ref{defn:quadraticInteger} quadratic orders $\OO_\Delta$ can also be written as  the $\ZZ$-module  \cite[p.~81]{Jac09}:
\begin{equation*}
	\OO_\Delta = \left[1, \frac{\Delta + \sqrt{\Delta}}{2} \right].
\end{equation*}
The maximal order of algebraic integers in the quadratic number field $\KK=\QQ(\sqrt{\Delta_0})$ is $[1, \omega_0]$.  We denote this as $\OO_{\KK}$.  The order $\OO_\KK$ is maximal since any order $\OO_\Delta = [1,f\omega_0]$ is a subring of $\OO_\KK$. 


%%%%%%%%%%
% IDEALS %
%%%%%%%%%%
\bigbreak
\section{Ideals of $\OO_\Delta$}

Having defined the maximal order of a quadratic number field, we can now define ideals of an order $\OO_\Delta$.

\begin{defn}
An integral \emph{ideal} $\mathfrak{a}$ of an order $\OO$, known as an \emph{$\OO$-ideal}, is an additive subgroup of $\OO$ such that $\xi \mathfrak{a} \subseteq \mathfrak{a}$ for any $\xi \in \OO$.
\end{defn}

\noindent
An ideal $\mathfrak{a}$ of any order can be represented as a two-dimensional $\OO$-module
\[
	\alpha \OO + \beta \OO = (\alpha, \beta)
\]
for generators $\alpha, \beta \in \OO$.  In the quadratic case, it can also be represented as a two dimensional $\ZZ$-module
\begin{equation}
\label{eq:idealZModule}
	(\alpha, \beta) = \left[sa, s \frac{b+ \sqrt{\Delta}}{2} \right] = sa \ZZ + s\frac{b + \sqrt{\Delta}}{2} \ZZ
\end{equation}
for some $s, a, b \in \ZZ$.  Notice that $s$ and $a$ are unique, and $b$ is unique $\bmod~2a$ since
\begin{equation*}
	\left[sa, s\frac{2ak+b+\sqrt{\Delta}}{2}\right] = \left[s(ak+1), s\frac{b+\sqrt{\Delta}}{2}\right]
\end{equation*}
for $k \in \ZZ$.

To see that we can represent an ideal in the form of \eqref{eq:idealZModule}, we first express $\mathfrak a$ as a finitely generated submodule $\mathfrak a=[a',b'+c'\omega]$ for some $a',b',c' \in \ZZ$.  Here, we follow \cite[pp~85-86]{Jac09}.  In the case that $\mathfrak a = [\xi_1]$ where $\xi_1 = a_1+b_1\omega$, let $a'=0$, $b' = a_1$ and $c'=b_1$, and we have $\mathfrak a = [\xi_1] = [a', b'+c'\omega]$.  Now, suppose $\mathfrak a = [\xi_1, \xi_2]$ for $\xi_1 = a_1 + b_1\omega$ and $\xi_2 = a_2+b_2\omega$.  We want a linear combination of $\xi_1$ and $\xi_2$ such that $\mathfrak a = [a',b'+c'\omega] = [\xi_1, \xi_2]$.  Let $c = \gcd(b_1, b_2)$.  Then there exists $x,y \in \ZZ$ such that 
\begin{equation}
\label{eq:cLinear}
	c = xb_1 + yb_2.
\end{equation}
Compute the first generator of the submodule, $a'$, as
\begin{align*}
	a' &= (b_2/c) \xi_1 - (b_1/c) \xi_2  \\
	&= (b_2/c) (a_1+b_1\omega) - (b_1/c) (a_2+b_2\omega)  \\
	&= a_1b_2/c -a_2b_1/c + b_1b_2\omega/c -b_1b_2\omega/c \\
	&= a_1b_2/c - a_2b_1/c
\end{align*}
and the second generator, $b'+c'\omega$, as
\begin{align*}
	b'+c'\omega &= x\xi_1 + y\xi_2 \\
	&= x(a_1+b_1\omega) + y(a_2+b_2\omega) \\
	&= xa_1+xb_1\omega + ya_2+yb_2\omega \\
	&= xa_1 + ya_2 + c\omega & \mbox{ by \eqref{eq:cLinear}}.
\end{align*}
As such, 
\[
	\mathfrak a = [\xi_1,\xi_2] = [(a_1b_2-b_1a_2)/c, xa_1+ya_2+c\omega] = [a',b'+c'\omega].
\]
Now, since $\omega\mathfrak a \subseteq \mathfrak a$ and $\omega a' \in \mathfrak a$, we have $\omega a' = ua' + v(b'+c'\omega)$ for some $u,v \in \ZZ$. Equating irrational parts, we get $a' = vc'$ and so $c'~|~a'$.  Equating rational parts, we have $ua'+vb' = uvc'+vb' = 0$ which implies $b' = -uc'$ and hence $c'~|~b'$.  Letting $s=c'$, $a=a'/c$, and $b = b'/c$ if $\Delta \equiv 1 \pmod 4$ and $b = 2b'/c$ otherwise, we have
\[
	\MM = [a', b'+c'\omega] = \left[sa, s\frac{b+ \sqrt{\Delta}}{2} \right]
\]
which is the desired computational form.

Here we provide some basic terminology useful when discussing ideals.  An ideal $\mathfrak{a} = [sa, s(b+\sqrt{\Delta})/2]$ with $s=1$ is called \emph{primitive}, and an ideal $\mathfrak{a}$ is \emph{invertible} if there exists an ideal $\mathfrak{b}$ such that $\mathfrak{a}\mathfrak{b}$ is primitive.  An ideal $\mathfrak{a}$ generated by a single element $\alpha \in \OO$ is \emph{principal}, and is written $\mathfrak{a} = \alpha \OO = (\alpha)$.  When $\OO$ is maximal, all ideals of $\OO$ are invertible.  If $\OO_\Delta$ for $\Delta = f^2\Delta_0$ is non-maximal, then an ideal $\mathfrak{a}$ is invertible if $\gcd(N(\mathfrak{a}),f)=1$.  $N(\mathfrak{a})$ is the \emph{norm} of an ideal defined as the number of distinct cosets in the group $\OO$ modulo $\mathfrak{a}$, denoted $|\OO/\mathfrak{a}|$ \cite[pp.~90-91]{Jac09}.  For an invertible ideal $\mathfrak{a} = [sa, s(b+\sqrt{\Delta})/2]$, the norm is $N(\mathfrak{a}) = s^2a$.  When two ideals $\mathfrak{a}$ and $\mathfrak{b}$ are invertible, the norm is multiplicative, i.e. $N(\mathfrak{a}\mathfrak{b}) = N(\mathfrak{a})N(\mathfrak{b})$ \cite[p.~92]{Jac09}.  The \emph{conjugate} of an ideal $\mathfrak{a} = (\alpha, \beta)$ is $\overline{\mathfrak{a}} = (\alpha, -\beta)$.  Finally, two ideals $\mathfrak{a}$ and $\mathfrak{b}$ of $\OO$ are said to be \emph{equivalent} if there exist principal ideals $(\alpha)$ and $(\beta)$ with  $\alpha, \beta \in \OO$ and $\alpha\beta \neq 0$ such that $(\alpha)\mathfrak{a} = (\beta)\mathfrak{b}$.  We denote the set of all ideals which are equivalent to an ideal $\mathfrak{a}$ as $[\mathfrak{a}]$ and this is called an \emph{ideal class} of $\OO$.  With this, we are  sufficiently able to describe the ideal class group.


%%%%%%%%%%%%%%%%%%%%%
% IDEAL CLASS GROUP %
%%%%%%%%%%%%%%%%%%%%%
\bigbreak
\section{Ideal Class Group}

Using the above notions of ideals in $\OO_\Delta$, we define the \emph{ideal class group}, $Cl_\Delta$, as the set of all equivalence classes of invertible $\OO$-ideals.  The group operation is defined as the product of two class representatives.  In \ref{subsec:reduction}, we state what it is for an ideal to be in reduced form.  In \ref{subsec:iipIdeals}, we define the identity ideal class, when a given ideal class is invertible, and when it is prime.  We cover, in subsection \ref{subsec:idealCompose}, the general case of how to compose two reduced class representatives together, and then in \ref{subsec:nucomp} we discuss how to perform composition such that the result is a reduced or almost reduced representative.  We then extend this to the case of computing the square (\ref{subsec:nudupl}) and cube (\ref{subsec:nucube}) of an ideal class.  Finally, in section \ref{section:computerRepresentation} we give a concrete representation of the ideal class group of imaginary quadratic fields and the operations on the elements of this group. 

%%%%%%%%%%%%%
% REDUCTION %
%%%%%%%%%%%%%
\subsection{Reduced Representatives}
\label{subsec:reduction}
\begin{defn}
Let $\mathfrak{a}$ be an $\OO$-ideal. Then $\mathfrak{a}$ is said to be \emph{reduced} if $\mathfrak{a}$ is primitive, and there does not exist a non-zero element $\beta \in \mathfrak{a}$ such that $|\beta| < N(\mathfrak{a})$ and $|\overline{\beta}| < N(\mathfrak{a})$.  In other words, $\mathfrak a$ is reduced if $N(\mathfrak{a})$ is a minimum element in $\mathfrak{a}$ \cite[p.~98]{Jac09}.
\end{defn}

We compute a reduced representative as follows:  Suppose $\mathfrak a = [a, (b + \sqrt\Delta)/2]$.  Let $c = (b^2 - \Delta)/4a$.  If $a > c$ compute ${\mathfrak a}^{-1}$ by swapping $a$ and $c$ and letting $b = -b$.  Since $b$ is unique $\bmod{~2a}$, we reduce $b \bmod{2a}$ and repeat while $\mathfrak a$ is not reduced.  Pseudo-code is given in Algorithm \ref{alg:reduce}.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% IDENTITY, INVERSE, PRIME %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Identity, Inverses, and Prime Ideals}\label{subsec:iipIdeals}

Having defined the class group as equivalence classes of ideals, we briefly define the identity ideal class, and what it means for a given class to be invertible or to be prime.

\begin{defn}
The \emph{identity ideal} is defined as $\OO_\Delta$ since for some ideal $\mathfrak a$, we have $\mathfrak a = \mathfrak a \OO_\Delta = \OO_\Delta \mathfrak a$.  The identity element in the ideal class group is defined as $[\OO_\Delta]$.  This is the class of principal ideals, since the identity ideal $\OO_\Delta$ is a principal ideal.  It has the property that for an ideal class $[\mathfrak a]$, that $[\mathfrak a] = [\mathfrak a \OO_\Delta] = [\OO_\Delta \mathfrak a]$. 
\end{defn}

\noindent
Since the ideal class group $Cl_\Delta$ is finite, for a given ideal class $[\mathfrak a]$ there exists a non-zero integer $n$ such that $[{\mathfrak a}^n] = [\OO_\Delta]$.  Here, $n$ is known as the \emph{order} of $[\mathfrak a]$.  If the order of an ideal class is 2, i.e. $[\mathfrak a^2] = [\OO_\Delta]$, then the ideal is said to be \emph{ambiguous}. We say that an ideal $\mathfrak a \neq (0)$ is \emph{invertible} if there exists an ideal $\mathfrak b$ such that $\mathfrak a \mathfrak b$ is principal, in other words $\mathfrak a \mathfrak b \in [\OO_\Delta]$ \cite[Definition 4.29]{Jac09}. Similarly, the ideal class $[\mathfrak a]$ is invertible if $[\mathfrak a \mathfrak b] = [\OO_\Delta]$.  Furthermore, if $\mathfrak a = (\alpha)$ is a principal ideal, then let $\mathfrak b = (\overline{\alpha})$ and $\mathfrak b$ is also principal.  Hence, the product $\mathfrak a \mathfrak b$ is principal and as such, any principal ideal is invertible.

\begin{defn}
An invertible ideal $\mathfrak p$ is \emph{prime} if for any two ideals $\mathfrak a$ and $\mathfrak b$ such that $\mathfrak p ~|~ \mathfrak a \mathfrak b$ then either $\mathfrak p ~|~ \mathfrak a$ or $\mathfrak p ~|~ \mathfrak b$ \cite[Definition 4.40]{Jac09}.  Furthermore, if $\mathfrak p$ is a prime ideal, then there exists a unique rational prime $p$ such that $\mathfrak p ~|~ (p)$ \cite[Theorem 4.41]{Jac09}.
\end{defn}



%%%%%%%%%%%%%%%
% COMPOSITION %
%%%%%%%%%%%%%%%
\subsection{Composition of Ideal Classes}\label{subsec:idealCompose}

We now discuss the ideal class group operation, composition.  Given reduced representatives $\mathfrak{a}$ and $\mathfrak{b}$ of ideal classes as $\ZZ$-modules, basic composition is as follows:
\begin{eqnarray*}
	\mathfrak{a} & = & a_1 \ZZ + \frac{b_1 + \sqrt{\Delta}}{2} \ZZ \\
	\mathfrak{b} & = & a_2 \ZZ + \frac{b_2 + \sqrt{\Delta}}{2} \ZZ.
\end{eqnarray*}

\noindent
There is no $s$ term in the above, as reduced representatives are primitive.  Component-wise multiplication of $\mathfrak a$ and $\mathfrak b$ give us
\begin{equation}
\begin{split}
	\mathfrak{a} \mathfrak{b} & = a_1a_2 \ZZ + a_1 \frac{b_2 + \sqrt{\Delta}}{2} \ZZ + a_2 \frac{b_1 + \sqrt{\Delta}}{2} \ZZ + \frac{b_1 + \sqrt{\Delta}}{2} \cdot \frac{b_2 + \sqrt{\Delta}}{2} \ZZ \\
	& = a_1a_2 \ZZ + \frac{a_1b_2 + a_1\sqrt{\Delta}}{2} \ZZ + \frac{a_2b_1 + a_2\sqrt{\Delta}}{2} \ZZ + \frac{b_1b_2 + (b_1+b_2)\sqrt{\Delta} + \Delta}{4} \ZZ \label{eq:composeExpanded}
\end{split}
\end{equation}

\noindent
The goal is to reformulate this given the representation in equation \eqref{eq:idealZModule} as
\[
	\mathfrak{a} \mathfrak{b} = sa \ZZ + s \left(\frac{b + \sqrt{\Delta}}{2}\right) \ZZ
\]
for some $s, a, b \in \ZZ$.  By the multiplicative property of the norm we have
\begin{eqnarray*}
	&& s^2a = N(\mathfrak{a}\mathfrak{b}) = N(\mathfrak{a})N(\mathfrak{b}) = a_1 a_2 \\
	& \Rightarrow & a = \frac{a_1a_2}{s^2}.
\end{eqnarray*}
Now, by the second term of equation \eqref{eq:composeExpanded} we know that $(a_1b_2 + a_1\sqrt{\Delta})/2 \in \mathfrak{a}\mathfrak{b}$.  It follows that there is some $x,y \in \ZZ$ such that
\[
	\frac{a_1b_2 + a_1\sqrt{\Delta}}{2} = xsa + ys\left(\frac{b+\sqrt{\Delta}}{2}\right).
\]
Equating irrational parts we have
\begin{equation*}
	\frac{a_1\sqrt{\Delta}}{2} = \frac{ys\sqrt{\Delta}}{2}
\end{equation*}
\noindent
Hence, $s ~|~ a_1$.  Similarly, by the third and fourth terms of equation \eqref{eq:composeExpanded} we have $(a_2b_1+a_2\sqrt{\Delta})/2 \in \mathfrak{a}\mathfrak{b}$ which implies that $s~|~a_2$ and $(b_1b_2 + (b_1+b_2)\sqrt{\Delta} + \Delta)/4 \in \mathfrak{a}\mathfrak{b}$ which implies that $s~|~(b_1+b_2)/2$. 

By the second generator $s(b+\sqrt\Delta)/2$ of $\mathfrak{a}\mathfrak{b}$ and the entire right hand side of equation \eqref{eq:composeExpanded} there exists $X, Y, V, W \in \ZZ$ such that
\begin{equation}
\label{eq:composeSecond}
\begin{split}
	\frac{sb+s\sqrt\Delta}{2} & = Xa_1a_2 + Y\frac{a_1b_2+a_1\sqrt\Delta}{2} + V\frac{a_2b_1 + a_2\sqrt{\Delta}}{2} + W\frac{b_1b_2 + (b_1+b_2)\sqrt{\Delta} + \Delta}{4} \\
	& = Xa_1a_2 + Y\frac{a_1b_2}{2} + V\frac{a_2b_1}{2} + W\frac{b_1b_2 + \Delta}{4} + \left(Y\frac{a_1}{2} + V\frac{a_2}{2} + W\frac{b_1+b_2}{4}\right)\sqrt\Delta. 
\end{split}
\end{equation}

\noindent
Again, by equating irrational parts we have
\begin{align}
	\frac{s\sqrt\Delta}{2} & = \left(Y\frac{a_1}{2} + V\frac{a_2}{2} + W\frac{b_1+b_2}{4}\right)\sqrt\Delta \nonumber \\
	s & = Ya_1 + Va_2 + W\frac{b_1+b_2}{2}. \label{eq:sAsGCD}
\end{align}
Since $s~|~\gcd(a_1, a_2, (b_1+b_2)/2)$, we have that $s = \gcd(a_1, a_2, (b_1+b_2)/2)$.  

It remains to compute $b \pmod{2a}$.  Recall that $a = a_1a_2/s^2$.  This time, by equating the rational parts of \eqref{eq:composeSecond} we have:
\begin{align}
	\frac{sb}{2} & = Xa_1a_2 + Y\frac{a_1b_2}{2} + V\frac{a_2b_1}{2} + W\frac{b_1b_2 + \Delta}{4} \nonumber \\
	b & = 2X\frac{a_1a_2}{s} + Y\frac{a_1b_2}{s} + V\frac{a_2b_1}{s} + W\frac{b_1b_2 + \Delta}{2s} \nonumber \\
	b & \equiv Y\frac{a_1b_2}{s} + V\frac{a_2b_1}{s} + W\frac{b_1b_2 + \Delta}{2s} \pmod{2a} \label{eq:bMod2a}
\end{align}

\noindent
This gives us $b$.  However, we can rewrite \eqref{eq:bMod2a} with fewer multiplies and divides.  By equation \eqref{eq:sAsGCD}, we have
\begin{align*}
	s & = Ya_1 + Va_2 + W\frac{b_1+b_2}{2} \\
	1 & = Y\frac{a_1}{s} + V\frac{a_2}{s} + W\frac{b_1+b_2}{2s} \\
	Y\frac{a_1}{s} & = 1 - V\frac{a_2}{s} - W\frac{b_1+b_2}{2s}.
\end{align*}

\noindent
Substituting into equation \eqref{eq:bMod2a} we get
\begin{alignat*}{2}
	b & \equiv b_2(1-V\frac{a_2}{s} - W\frac{b_1+b_2}{2s}) + V\frac{a_2b_1}{s} + W\frac{b_1b_2 + \Delta}{2s} && \pmod{2a} \\
	& \equiv b_2 - V\frac{a_2b_2}{s} - W\frac{b_1b_2+{b_2}^2}{2s} + V\frac{a_2b_1}{s} + W\frac{b_1b_2 + \Delta}{2s} && \pmod{2a} \\
	& \equiv b_2 + V\frac{a_2(b_1-b_2)}{s} + W\frac{\Delta - {b_2}^2}{2s} && \pmod{2a} \\
	& \equiv b_2 + V\frac{2a_2(b_1-b_2)}{2s} + W\frac{2a_2(\Delta - {b_2}^2)}{2a_2 \cdot 2s} && \pmod{2a} \\
	& \equiv b_2 + \frac{2a_2}{s} \left( V\frac{b_1-b_2}{2} + W\frac{\Delta - {b_2}^2}{4a} \right) && \pmod{2a}.
\end{alignat*}
Let $c_2 = ({b_2}^2 - \Delta)/4a_2$ and $U = V(b_1-b_2)/2 - Wc_2$ and we have
\[
	b \equiv b_2 + \frac{2a_2}{s} U \pmod{2a}.
\]

\noindent
Hence, given two representative ideals $\mathfrak a$ and $\mathfrak b$ in reduced form as $\ZZ$-modules, we can compute their (non-reduced) product using the following steps: Let $\mathfrak a = \left[a_1, \frac{b_1 + \sqrt\Delta}{2}\right]$ and $\mathfrak b = \left[a_2, \frac{b_2 + \sqrt\Delta}{2}\right]$ and $c_2 = ({b_2}^2-\Delta)/4a_2$.  Compute 
\begin{equation*}
s = Ya_1 + Va_2 + W\frac{b_1+b_2}{2}
\end{equation*}
for $Y, V, W \in \ZZ$ using the extended Euclidean algorithm. Then compute
\begin{align*} 
	a &= (a_1a_2)/s \\ 
	b &= (b_2 + 2Ua_2/s) \bmod{2a}
\end{align*}
where
\begin{equation*}
	U = V(b_1-b_2)/2 - Wc_2.
\end{equation*}



%%%%%%%%%%
% NUCOMP %
%%%%%%%%%%
\subsection{Fast Ideal Composition (NUCOMP)}\label{subsec:nucomp}

Shanks gives an algorithm for composing two ideal class representatives such that their product is reduced or almost reduced.  The algorithm is known as NUCOMP and stands for ``New CoMPosition''.  This algorithm is often faster in practice as the intermediate numbers are smaller and the final product requires fewer (often no) applications of the reduction operator to be converted to reduced form.  The two main steps to computing a reduced product using NUCOMP is first, to compute the partial quotients $q_i$ that lead to a reduced ideal without explicitly computing the product form $[a,(b+\sqrt\Delta)/2]$, while the second component is to derive formulas for $a_i$ and $b_i$ using the partial quotients $q_i$.  The description of NUCOMP provided here is a high level description of the algorithm based on \cite[pp.119-123]{Jac09}.

The basic idea is that rather than computing the product form
\[
	\left[a, \frac{b+\sqrt\Delta}{2} \right] = \left[a_1, \frac{b_1+\sqrt\Delta}{2} \right] \cdot \left[a_2, \frac{b_2+\sqrt\Delta}{2} \right]
\]
directly and then computing the reduced ideal representative, we instead observe that
\begin{align*}
	\frac{b}{a} &= \frac{b_2 + Ua_2/s}{(a_1/s)(a_2/s)} \\
	&= \frac{s^2 b_2+sUa_2}{a_1a_2} \\
	&\approx \frac{sU}{a_1}
\end{align*}
where $U$ is given by algorithm \ref{alg:idealCompose}.  In this case, $sU$ and $a_1$ are roughly the same as $\sqrt\Delta$ in size.  So instead, we compute the continued fraction expansion of $sU/a_1 = \langle q_0, q_1, \dots, q_i, \phi_{i+1} \rangle$ using
\begin{align*}
	q_i &= \floor{R_{i-2} / R_{i-1}}, &
	R_i &= R_{i-2} - q_i R_{i-1}, &
	C_i &= C_{i-2} - q_i C_{i-1}
\end{align*}
with
\begin{align*}
	R_{-2} &= sU,  & C_{-2} &= -1, \\
	R_{-1} &= a_1, & C_{-1} &= 0
\end{align*}
and by \cite[Theorem 5.43]{Jac09}, we select $i$ such that
\[
	R_i < \sqrt{a_1/a_2} ~ |\Delta/4|^{1/4} < R_{i-1}.
\]
We then compute
\begin{align*}
	M_1 &= \frac{R_i a_2 + sC_i(b_1-b_2)/2}{a_1}  \in \ZZ, &
	M_2 &= \frac{R_i (b_1+b_2)/2 - s C_i c_2}{a_1} \in \ZZ, \\
	a &= (-1)^{i+1} (R_i M_1  - C_i M_2), &
	b &\equiv \frac{R_i a_2 /s + C_{i-1} a}{C_i} \pmod{2a}
\end{align*}
where $c_2 = ({b_2}^2-\Delta)/4a_2$ \cite[Equation 5.44]{Jac09}.  The ideal class representative $[a, (b+\sqrt\Delta)/2]$ in this case is reduced or almost reduced.  See algorithm \ref{alg:nucomp} for pseudocode of our implementation.


%%%%%%%%%%
% NUDUPL %
%%%%%%%%%%
\subsection{Fast Ideal Squaring (NUDUPL)}\label{subsec:nudupl}

In the case of ideal class squaring, much of the arithmetic used to compose two ideal classes can be simplified since in this case $a_1=a_2$ and $b_1=b_2$.  Let 
\[
	s = Xa_1 + Yb_1
\]
for $X,Y \in \ZZ$ using the extended Euclidean algorithm; and let 
\[
	U = Yc_1.
\]
As before, we compute the continued fraction expansion of $sU/a_1$, but the bound on $R_i$ simplifies to
\[
	R_i < |\Delta/4|^{1/4} < R_{i-1}.
\]
Computing the ideal class representative simplifies as well.  We have
\begin{align*}
	M_1 &= R_i, & 
	M_2 &= \frac{R_i b_1 - sC_i c_1}{a_1}, \\
	a &= (-1)^{i+1}({R_i}^2 - C_i M_2), &
	b &\equiv \frac{R_i a_1/s  + C_{i-1} a}{C_i} \pmod{2a}.
\end{align*}
As before, the representative $[a, (b+\sqrt\Delta)/2]$ is either reduced or almost reduced.  \break Pseudocode for our implementation is given in algorithm \ref{alg:nudupl}.


%%%%%%%%%%
% NUCUBE %
%%%%%%%%%%
\subsection{Fast Ideal Cubing (NUCUBE)}\label{subsec:nucube}

Common exponentiation methods using binary representations of exponents make use of squaring and multiplication operations.  If we consider binary-ternary representations of exponents, cubing becomes practical.  In general, if we want to compute ${\mathfrak a}^3$ for an ideal class representative $\mathfrak a = [a, (b+\sqrt\Delta)/2]$, we can take advantage of the simplification that happens when expanding the computation of ${\mathfrak a}^2 \mathfrak a$.  Here we provide a high level description of a technique for cubing based on similar ideas to NUCOMP and NUDUPL, namely that of computing the quotients of a continued fraction expansion useful to computing a reduced ideal representative.  A detailed description and analysis of this technique can be found in \cite{Ijs2010}.

An algorithm for ideal cubing in quadratic number fields is given as algorithm \ref{alg:idealCube} and is modified from \cite[Appendix A, Algorithm 5]{Ijs2010} so as to conform to the conventions used in this thesis. To modify this algorithm to compute an almost reduced ideal, as in NUCOMP, we check before step 13 if $L < \sqrt{|a_1|} ~ |\Delta/4|^{1/4}$.  If so, we complete the cube as in algorithm \ref{alg:idealCube}.  Otherwise, as in NUCOMP and NUCUBE, we compute the continued fraction expansion of $L/K = \langle q_0, q_1, \dots, q_i, \phi_{i+1}\rangle$ for $i$ such that
\[
	R_i < \sqrt{|a_1|} ~ |\Delta/4|^{1/4} < R_{i-1}.
\]

\noindent
Having computed $R_i$ and $C_i$, the reduced or almost reduced ideal ${\mathfrak a}^3$ can be computed as follows:
\begin{align*}
	b_2 &= b_1 -2NK \pmod L, & \\
	M_1 &= (NR_i + (b_2-b_1)C_i)/L, &
	M_2 &= (R_i(b_1+b_2)+c_1s_2)/L, \\
	a &= (-1)^{i-1}(R_iM_1-C_iM_2), &
	b &= (NR_i + aC_{i-1})/C_i-b_1.
\end{align*}
Then, $\mathfrak a^3 = [a, (b+\sqrt\Delta)/2]$.  Pseudo-code for the complete NUCUBE used is given in Algorithm \ref{alg:nucube}.




\end{document}
